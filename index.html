<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 ì˜¤í‚¤ë‚˜ì™€ í—ˆë‹ˆë¬¸ í”Œë˜ë„ˆ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #F0F9FF;
            color: #334155;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 300px;
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }

        .active-tab { background-color: #0EA5E9; color: white; border-color: #0EA5E9; }
        
        .timeline-line {
            position: absolute; left: 20px; top: 0; bottom: 0; width: 2px; background-color: #CBD5E1; z-index: 0;
        }

        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }

        .prose p { margin-bottom: 0.5em; }
        .prose ul { list-style-type: disc; padding-left: 1.2em; margin-bottom: 0.5em; }
        .prose strong { color: #0369a1; }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col relative">

    <!-- Navbar -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center">
                    <i class="fa-solid fa-plane-departure text-sky-500 text-2xl mr-3"></i>
                    <h1 class="font-bold text-xl text-slate-800">Okinawa Honeymoon <span class="text-xs font-normal text-slate-500 block sm:inline">2025.12.02 - 12.09</span></h1>
                </div>
                <div class="text-sm font-medium text-sky-600">
                    Day <span id="current-day-display">1</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 space-y-12 pb-24">

        <!-- Section 1: Overview -->
        <section id="overview" class="bg-white rounded-2xl shadow-sm p-6 border border-slate-100">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">ì—¬í–‰ ê°œìš”</h2>
                <p class="text-slate-600">ì˜¤í‚¤ë‚˜ì™€ ë¶ë¶€, ì¤‘ë¶€, ë‚¨ë¶€ë¥¼ ì•„ìš°ë¥´ëŠ” 7ë°• 8ì¼ í—ˆë‹ˆë¬¸.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="bg-slate-50 rounded-xl p-4">
                    <h3 class="text-center font-semibold text-slate-700 mb-4">ìˆ™ë°• ë° ì§€ì—­ ë°°ë¶„</h3>
                    <div class="chart-container">
                        <canvas id="tripChart"></canvas>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-sky-50 p-4 rounded-xl text-center">
                        <i class="fa-solid fa-car text-sky-500 text-2xl mb-2"></i>
                        <h4 class="font-bold text-slate-700">ë Œí„°ì¹´</h4>
                        <p class="text-xs text-slate-500">ë§ˆë¦¬ì˜¤ ë Œí„°ì¹´</p>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-xl text-center">
                        <i class="fa-solid fa-sun text-orange-400 text-2xl mb-2"></i>
                        <h4 class="font-bold text-slate-700">12ì›” ë‚ ì”¨</h4>
                        <p class="text-xs text-slate-500">í‰ê·  20Â°C (ì„ ì„ í•¨)</p>
                    </div>
                    <div class="bg-emerald-50 p-4 rounded-xl text-center col-span-2">
                        <i class="fa-solid fa-heart text-emerald-500 text-2xl mb-2"></i>
                        <h4 class="font-bold text-slate-700">ì»¨ì…‰</h4>
                        <div class="flex justify-between text-xs mt-2 px-4">
                            <span>íœ´ì–‘ (ë¶ë¶€/ì¤‘ë¶€)</span>
                            <span>ë„ì‹œ (ë‚¨ë¶€)</span>
                        </div>
                        <div class="w-full bg-emerald-200 rounded-full h-2.5 mt-1">
                            <div class="bg-emerald-500 h-2.5 rounded-full" style="width: 70%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Itinerary -->
        <section id="itinerary" class="bg-white rounded-2xl shadow-sm p-6 border border-slate-100">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">ì¼ë³„ ìƒì„¸ ì¼ì •</h2>
                <p class="text-slate-600">íƒ­ì„ í´ë¦­í•˜ì—¬ ë‚ ì§œë³„ ë™ì„ ì„ í™•ì¸í•˜ì„¸ìš”.</p>
            </div>
            <div class="flex overflow-x-auto space-x-2 pb-4 scrollbar-hide mb-6" id="date-tabs"></div>
            <div id="day-content" class="min-h-[400px]"></div>
        </section>

        <!-- Section 3: Food -->
        <section id="food" class="bg-white rounded-2xl shadow-sm p-6 border border-slate-100">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">ë§›ì§‘ & ì¹´í˜</h2>
                <p class="text-slate-600">ì¹´ë“œë¥¼ í´ë¦­í•˜ë©´ ë§µì½”ë“œê°€ ë³µì‚¬ë©ë‹ˆë‹¤.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="space-y-4">
                    <h3 class="font-bold text-lg text-emerald-600 border-b-2 border-emerald-100 pb-2"><i class="fa-solid fa-tree mr-2"></i>ë¶ë¶€</h3>
                    <div id="food-north-list" class="space-y-3"></div>
                </div>
                <div class="space-y-4">
                    <h3 class="font-bold text-lg text-sky-600 border-b-2 border-sky-100 pb-2"><i class="fa-solid fa-water mr-2"></i>ì¤‘ë¶€</h3>
                    <div id="food-central-list" class="space-y-3"></div>
                </div>
                <div class="space-y-4">
                    <h3 class="font-bold text-lg text-indigo-600 border-b-2 border-indigo-100 pb-2"><i class="fa-solid fa-city mr-2"></i>ë‚¨ë¶€</h3>
                    <div id="food-south-list" class="space-y-3"></div>
                </div>
            </div>
        </section>

        <!-- Section 4: Map Code Search -->
        <section class="bg-slate-800 text-white rounded-2xl shadow-lg p-8 mb-8">
            <h2 class="text-xl font-bold mb-4"><i class="fa-solid fa-magnifying-glass mr-2"></i>ë§µì½”ë“œ ê²€ìƒ‰</h2>
            <input type="text" id="mapcode-search" placeholder="ì¥ì†Œëª… (ì˜ˆ: ì¸„ë¼ìš°ë¯¸)" class="w-full p-3 rounded-lg text-slate-900 focus:outline-none focus:ring-2 focus:ring-sky-500">
            <div id="search-results" class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm"></div>
        </section>
        
        <!-- Settings Button (For Resetting API Key) -->
        <div class="text-center pb-8">
             <button onclick="resetApiKey()" class="text-xs text-slate-400 underline hover:text-slate-600">AI í‚¤ ì¬ì„¤ì •í•˜ê¸°</button>
        </div>

    </main>

    <!-- Floating AI Button -->
    <div class="fixed bottom-6 right-6 z-50">
        <button onclick="toggleAIChat()" class="bg-gradient-to-r from-violet-500 to-fuchsia-500 hover:from-violet-600 hover:to-fuchsia-600 text-white rounded-full p-4 shadow-xl transition-all transform hover:scale-105 flex items-center gap-2">
            <i class="fa-solid fa-wand-magic-sparkles text-xl"></i>
            <span class="font-bold hidden sm:inline">AI ì»¨ì‹œì–´ì§€</span>
        </button>
    </div>

    <!-- AI Chat Modal -->
    <div id="ai-chat-modal" class="hidden fixed bottom-24 right-6 w-80 sm:w-96 bg-white rounded-2xl shadow-2xl border border-slate-200 z-50 flex flex-col overflow-hidden h-[500px]">
        <div class="bg-gradient-to-r from-violet-500 to-fuchsia-500 p-4 text-white flex justify-between items-center">
            <div class="flex items-center gap-2"><i class="fa-solid fa-robot"></i><h3 class="font-bold">AI ì—¬í–‰ ì»¨ì‹œì–´ì§€</h3></div>
            <button onclick="toggleAIChat()" class="text-white hover:text-slate-200"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="chat-messages" class="flex-grow p-4 overflow-y-auto bg-slate-50 space-y-4 text-sm">
            <div class="flex items-start gap-2">
                <div class="bg-violet-100 p-2 rounded-full"><i class="fa-solid fa-robot text-violet-600"></i></div>
                <div class="bg-white p-3 rounded-lg shadow-sm border border-slate-100 max-w-[85%] text-slate-700">
                    ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?<br>ë§›ì§‘ ì¶”ì²œ, ì¼ë³¸ì–´ ë²ˆì—­ ë“±ì„ ë¬¼ì–´ë³´ì„¸ìš”!
                </div>
            </div>
        </div>
        <div class="px-4 py-2 bg-white border-t border-slate-100 overflow-x-auto whitespace-nowrap scrollbar-hide flex gap-2">
            <button onclick="sendQuickPrompt('recommend')" class="px-3 py-1 bg-violet-50 text-violet-600 text-xs rounded-full border border-violet-100 hover:bg-violet-100">âœ¨ ë§›ì§‘ ì¶”ì²œ</button>
            <button onclick="sendQuickPrompt('translate')" class="px-3 py-1 bg-fuchsia-50 text-fuchsia-600 text-xs rounded-full border border-fuchsia-100 hover:bg-fuchsia-100">ğŸ—£ï¸ ì¼ë³¸ì–´ ë²ˆì—­</button>
        </div>
        <div class="p-3 bg-white border-t border-slate-100 flex gap-2">
            <input type="text" id="ai-input" placeholder="ë©”ì‹œì§€ ì…ë ¥..." class="flex-grow bg-slate-100 border-0 rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-violet-300 outline-none" onkeypress="handleEnter(event)">
            <button onclick="sendMessage()" class="bg-violet-500 text-white rounded-full w-10 h-10 flex items-center justify-center hover:bg-violet-600 transition-colors"><i class="fa-solid fa-paper-plane text-sm"></i></button>
        </div>
    </div>

    <script>
        // --- DATA ---
        const itinerary = [
            { date: "12/2 (í™”)", day: 1, title: "ì˜¤í‚¤ë‚˜ì™€ ë„ì°© & ë¶ë¶€ ì´ë™", stay: "ë¶ë¶€ ë¦¬ì¡°íŠ¸", schedule: [
                { time: "12:00", activity: "ë‚˜í•˜ ê³µí•­ ë„ì°©", note: "ì…êµ­ ìˆ˜ì†" },
                { time: "13:30", activity: "ë Œí„°ì¹´ í”½ì—…", note: "ë§ˆë¦¬ì˜¤ ë Œí„°ì¹´", mapCode: "33 095 244*60" },
                { time: "14:30", activity: "ë¶ë¶€ ì´ë™ (ê³ ì†ë„ë¡œ)", note: "ì¿„ë‹¤ IC í•˜ì°¨" },
                { time: "18:30", activity: "ì €ë… ì‹ì‚¬", note: "ìš°í›„ì•¼ or ìº¡í‹´ ìº¥ê±°ë£¨" }
            ]},
            { date: "12/3 (ìˆ˜)", day: 2, title: "ì¸„ë¼ìš°ë¯¸ & ë¹„ì„¸í›„ì¿ ê¸¸", stay: "ë¶ë¶€ ë¦¬ì¡°íŠ¸", schedule: [
                { time: "10:00", activity: "ì¸„ë¼ìš°ë¯¸ ìˆ˜ì¡±ê´€", note: "ì˜¤í‚¤ì§± ì‡¼ ê´€ëŒ", mapCode: "553 075 797*77" },
                { time: "13:00", activity: "ì ì‹¬: ì‚¿ì§±ì†Œë°”", note: "í˜„ì§€ì¸ ë§›ì§‘", mapCode: "553 046 397*55" },
                { time: "14:30", activity: "ë¹„ì„¸í›„ì¿ ê¸¸ ì‚°ì±…", note: "ìì „ê±° ë ŒíŠ¸ ì¶”ì²œ", mapCode: "553 105 654*77" }
            ]},
            { date: "12/4 (ëª©)", day: 3, title: "ì½”ìš°ë¦¬ & ë§¥ì£¼ ê³µì¥", stay: "ë¶ë¶€ ë¦¬ì¡°íŠ¸", schedule: [
                { time: "10:30", activity: "ì½”ìš°ë¦¬ ëŒ€êµ", note: "ì‰¬ë¦¼í”„ ì›¨ê±´", mapCode: "485 662 041*33" },
                { time: "14:00", activity: "ì˜¤ë¦¬ì˜¨ í•´í”¼íŒŒí¬", note: "ì˜ˆì•½ í•„ìˆ˜ / ìš´ì „ì ë…¼ì•Œì½œ", mapCode: "206 598 867*44" },
                { time: "18:30", activity: "ì €ë…: ì´ìì¹´ì•¼", note: "ì•¼ê°€ì§€ì„¬ ê·¼ì²˜ ë“±" }
            ]},
            { date: "12/5 (ê¸ˆ)", day: 4, title: "ë§Œìëª¨ & ì¤‘ë¶€ ì´ë™", stay: "ì¤‘ë¶€ í˜¸í…”", schedule: [
                { time: "11:30", activity: "ë§Œìëª¨", note: "ì½”ë¼ë¦¬ ë°”ìœ„", mapCode: "206 312 039*17" },
                { time: "13:00", activity: "ì ì‹¬: ë‚˜ì¹´ë¬´ë¼ ì†Œë°”", note: "ë˜ëŠ” íŒ¬ì¼€ì´í¬" },
                { time: "17:30", activity: "ì•„ë©”ë¦¬ì¹¸ ë¹Œë¦¬ì§€", note: "ì•¼ê²½ ë° ì‡¼í•‘", mapCode: "33 526 450*63" }
            ]},
            { date: "12/6 (í† )", day: 5, title: "í‘¸ë¥¸ë™êµ´ & ì¹´í˜", stay: "ì¤‘ë¶€ í˜¸í…”", schedule: [
                { time: "09:00", activity: "í‘¸ë¥¸ë™êµ´ ìŠ¤ë…¸í´ë§", note: "ë§ˆì—ë‹¤ ê³¶", mapCode: "206 062 685*85" },
                { time: "12:30", activity: "ì ì‹¬: ì‚°ìŠ¤ì‹œ", note: "êµí† ì‹ ê°€ì •ì‹", mapCode: "33 466 690*71" },
                { time: "14:30", activity: "ë°˜íƒ€ ì¹´í˜", note: "í˜¸ì‹œë…¸ ë¦¬ì¡°íŠ¸ ë·°", mapCode: "33 882 485*82" },
                { time: "16:30", activity: "í•´ì¤‘ë„ë¡œ ë“œë¼ì´ë¸Œ", note: "ì—¬ìœ ë¡œìš´ ë“œë¼ì´ë¸Œ", mapCode: "499 576 274*33" }
            ]},
            { date: "12/7 (ì¼)", day: 6, title: "ë¯¸ë‚˜í† ê°€ì™€ & ë‚˜í•˜", stay: "ë‚¨ë¶€ í˜¸í…”", schedule: [
                { time: "11:30", activity: "ë¯¸ë‚˜í† ê°€ì™€ íƒ€ìš´", note: "ì˜¤í•˜ì½”ë¥´í…Œ íƒ€ë¥´íŠ¸", mapCode: "33 341 033*55" },
                { time: "15:00", activity: "ë‚˜í•˜ ì²´í¬ì¸", note: "êµ­ì œê±°ë¦¬ ì¸ê·¼" },
                { time: "19:00", activity: "ì €ë…: ì•¼í‚¤ë‹ˆì¿  í”Œì‹¬", note: "ì²œì—” ìˆ  ë¬´ì œí•œ", mapCode: "33 157 532*71" }
            ]},
            { date: "12/8 (ì›”)", day: 7, title: "ë‚¨ë¶€ ê´€ê´‘", stay: "ë‚¨ë¶€ í˜¸í…”", schedule: [
                { time: "10:00", activity: "ìŠˆë¦¬ì„±", note: "ë¥˜í ì™•êµ­", mapCode: "33 161 526*55" },
                { time: "12:30", activity: "ì ì‹¬: ë§ˆì œë©˜ ë§ˆí˜¸ë¡œë°”", note: "ë¹„ë¹”ë¼ë©˜", mapCode: "33 157 266*82" },
                { time: "14:30", activity: "ìš°ë¯¸ì¹´ì§€ í…Œë¼ìŠ¤", note: "ê³µí•­ ê·¼ì²˜ ë·°ë§›ì§‘", mapCode: "33 002 602*06" }
            ]},
            { date: "12/9 (í™”)", day: 8, title: "ê·€êµ­", stay: "ì§‘ìœ¼ë¡œ", schedule: [
                { time: "10:00", activity: "ë Œí„°ì¹´ ë°˜ë‚©", note: "ë§ˆë¦¬ì˜¤ ë Œí„°ì¹´" },
                { time: "11:00", activity: "ë‚˜í•˜ ê³µí•­", note: "ë©´ì„¸ì  ë° ì‹ì‚¬" },
                { time: "13:00", activity: "ì¶œêµ­", note: "Happy Honeymoon!" }
            ]}
        ];

        const foodPlaces = {
            north: [{name:"ì‚¿ì§±ì†Œë°”",desc:"í˜„ì§€ ë§›ì§‘",map:"553 046 397*55"}, {name:"ì‰¬ë¦¼í”„ ì›¨ê±´",desc:"ì½”ìš°ë¦¬ëŒ€êµ ê°ˆë¦­ìƒˆìš°",map:"485 692 129*71"}, {name:"ìš°í›„ì•¼",desc:"ë°±ë…„ê³ ê°€ ì•„êµ¬ë¼ì§€",map:"206 745 056*82"}],
            central: [{name:"ì˜¤í•˜ì½”ë¥´í…Œ",desc:"ë¯¸ë‚˜í† ê°€ì™€ íƒ€ë¥´íŠ¸",map:"33 341 002*28"}, {name:"ì´ì‹œêµ¬í›„",desc:"ë‹­ìœ¡ìˆ˜ ì†Œë°”",map:"33 341 123*22"}, {name:"ë°˜íƒ€ ì¹´í˜",desc:"ì••ë„ì  ì˜¤ì…˜ë·°",map:"33 882 485*82"}],
            south: [{name:"ì•¼ë¼ë‹ˆê¾¸ í”Œì‹¬",desc:"ìˆ  ë¬´ì œí•œ ì•¼í‚¤ë‹ˆì¿ ",map:"33 157 532*71"}, {name:"ë§ˆì œë©˜ ë§ˆí˜¸ë¡œë°”",desc:"ë¹„ë¹”ë¼ë©˜",map:"33 157 266*82"}, {name:"ì•¼íƒ€ì´ë¬´ë¼",desc:"í¬ì¥ë§ˆì°¨ ê±°ë¦¬",map:"33 157 406*41"}]
        };

        const searchCodes = [
            {name:"ì¸„ë¼ìš°ë¯¸ ìˆ˜ì¡±ê´€",code:"553 075 797*77"}, {name:"ì½”ìš°ë¦¬ ëŒ€êµ",code:"485 662 041*33"}, {name:"ë§Œìëª¨",code:"206 312 039*17"},
            {name:"ì•„ë©”ë¦¬ì¹¸ ë¹Œë¦¬ì§€",code:"33 526 450*63"}, {name:"í‘¸ë¥¸ë™êµ´",code:"206 062 685*85"}, {name:"ë¯¸ë‚˜í† ê°€ì™€",code:"33 341 033*55"},
            {name:"ìŠˆë¦¬ì„±",code:"33 161 526*55"}, {name:"ìš°ë¯¸ì¹´ì§€ í…Œë¼ìŠ¤",code:"33 002 602*06"}, {name:"êµ­ì œê±°ë¦¬",code:"33 157 435*41"}
        ];

        // --- RENDER LOGIC ---
        function initApp() {
            renderChart();
            renderTabs();
            renderFood();
            initSearch();
        }

        function renderChart() {
            const ctx = document.getElementById('tripChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ë¶ë¶€', 'ì¤‘ë¶€', 'ë‚¨ë¶€'],
                    datasets: [{ data: [3, 2, 2], backgroundColor: ['#10B981', '#0EA5E9', '#6366F1'], borderWidth: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: {position: 'bottom'} } }
            });
        }

        function renderTabs() {
            const container = document.getElementById('date-tabs');
            itinerary.forEach((day, idx) => {
                const btn = document.createElement('button');
                btn.className = `flex-shrink-0 px-4 py-2 rounded-full border text-sm font-medium transition-colors ${idx === 0 ? 'active-tab' : 'bg-white text-slate-500 border-slate-200 hover:bg-slate-50'}`;
                btn.innerText = day.date;
                btn.onclick = () => switchTab(idx);
                container.appendChild(btn);
            });
            switchTab(0);
        }

        function switchTab(idx) {
            const tabs = document.getElementById('date-tabs').children;
            for(let i=0; i<tabs.length; i++) tabs[i].className = i===idx ? 'flex-shrink-0 px-4 py-2 rounded-full border text-sm font-medium transition-colors active-tab' : 'flex-shrink-0 px-4 py-2 rounded-full border text-sm font-medium transition-colors bg-white text-slate-500 border-slate-200 hover:bg-slate-50';
            
            const data = itinerary[idx];
            document.getElementById('current-day-display').innerText = data.day;
            
            let html = `<div class="bg-white rounded-xl p-4 mb-4 border-l-4 ${idx < 3 ? 'border-emerald-500' : (idx < 5 ? 'border-sky-500' : 'border-indigo-500')} shadow-sm">
                        <h3 class="text-xl font-bold text-slate-800">${data.title}</h3>
                        <p class="text-sm text-slate-500 mt-1"><i class="fa-solid fa-bed mr-2"></i>${data.stay}</p>
                        </div><div class="relative mt-6"><div class="timeline-line"></div>`;
            
            data.schedule.forEach(item => {
                html += `<div class="relative pl-8 pb-8 group">
                        <div class="absolute left-0 top-1 w-4 h-4 rounded-full border-2 border-white shadow-sm z-10 ${idx < 3 ? 'bg-emerald-500' : (idx < 5 ? 'bg-sky-500' : 'bg-indigo-500')}"></div>
                        <div class="bg-slate-50 rounded-xl p-4 card-hover border border-slate-100">
                            <div class="flex justify-between items-start mb-1">
                                <span class="font-bold text-slate-800 text-lg">${item.time}</span>
                                ${item.mapCode ? `<span class="text-xs bg-slate-200 text-slate-600 px-2 py-1 rounded cursor-pointer hover:bg-slate-300" onclick="navigator.clipboard.writeText('${item.mapCode.split('(')[0].trim()}')"><i class="fa-solid fa-copy mr-1"></i>${item.mapCode}</span>` : ''}
                            </div>
                            <h4 class="font-bold text-base text-slate-700 mb-1">${item.activity}</h4>
                            <p class="text-sm text-slate-500">${item.note}</p>
                        </div></div>`;
            });
            document.getElementById('day-content').innerHTML = html + '</div>';
        }

        function renderFood() {
            const makeCard = (item) => `<div class="bg-slate-50 p-3 rounded-lg border border-slate-100 card-hover cursor-pointer" onclick="navigator.clipboard.writeText('${item.map.split('*')[0]}')">
                <div class="flex justify-between items-center"><h4 class="font-bold text-slate-700">${item.name}</h4><i class="fa-solid fa-location-dot text-slate-400 text-xs"></i></div>
                <p class="text-xs text-slate-500 mt-1">${item.desc}</p><div class="mt-2 text-xs font-mono text-slate-400 bg-white p-1 rounded inline-block border border-slate-200">Map: ${item.map}</div></div>`;
            
            document.getElementById('food-north-list').innerHTML = foodPlaces.north.map(makeCard).join('');
            document.getElementById('food-central-list').innerHTML = foodPlaces.central.map(makeCard).join('');
            document.getElementById('food-south-list').innerHTML = foodPlaces.south.map(makeCard).join('');
        }

        function initSearch() {
            document.getElementById('mapcode-search').addEventListener('input', (e) => {
                const val = e.target.value.toLowerCase();
                const res = document.getElementById('search-results');
                if(!val) { res.innerHTML = ''; return; }
                const hits = searchCodes.filter(i => i.name.toLowerCase().includes(val));
                res.innerHTML = hits.length ? hits.map(i => `<div class="bg-slate-700 p-3 rounded flex justify-between items-center hover:bg-slate-600 transition cursor-pointer" onclick="navigator.clipboard.writeText('${i.code.split('*')[0]}')"><span>${i.name}</span><span class="font-mono text-sky-300 text-xs">${i.code} <i class="fa-solid fa-copy ml-1"></i></span></div>`).join('') : '<p class="text-slate-400 col-span-2 text-center">ê²°ê³¼ ì—†ìŒ</p>';
            });
        }

        // --- SECURE AI LOGIC ---
        let isChatOpen = false;

        function getApiKey() {
            let key = localStorage.getItem('gemini_api_key');
            if (!key) {
                key = prompt("ğŸ”’ Gemini API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.\n(í‚¤ëŠ” ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤)");
                if (key) {
                    localStorage.setItem('gemini_api_key', key);
                    alert("âœ… API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
                }
            }
            return key;
        }

        function resetApiKey() {
            if(confirm("ì €ì¥ëœ API í‚¤ë¥¼ ì‚­ì œí•˜ê³  ë‹¤ì‹œ ì…ë ¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                localStorage.removeItem('gemini_api_key');
                alert("í‚¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. AI ê¸°ëŠ¥ì„ ë‹¤ì‹œ ì‚¬ìš©í•  ë•Œ ìƒˆ í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                location.reload();
            }
        }

        function toggleAIChat() {
            const modal = document.getElementById('ai-chat-modal');
            isChatOpen = !isChatOpen;
            if (isChatOpen) {
                if(!localStorage.getItem('gemini_api_key')) getApiKey();
                modal.classList.remove('hidden');
                modal.classList.add('animate-slide-up');
                setTimeout(() => document.getElementById('ai-input').focus(), 300);
            } else {
                modal.classList.add('hidden');
            }
        }

        function sendQuickPrompt(type) {
            const prompts = {
                recommend: "ì˜¤í‚¤ë‚˜ì™€ ì—¬í–‰ ì¤‘ì¸ë°, ë¡œë§¨í‹±í•œ ë¶„ìœ„ê¸°ì˜ ë§›ì§‘ì´ë‚˜ ìˆ¨ê²¨ì§„ ëª…ì†Œ í•˜ë‚˜ë§Œ ì¶”ì²œí•´ì¤˜. ë„ˆë¬´ ê¸¸ì§€ ì•Šê²Œ í•µì‹¬ë§Œ.",
                translate: "ì¼ë³¸ ì‹ë‹¹ì´ë‚˜ í˜¸í…”ì—ì„œ ìì£¼ ì“°ëŠ” ìœ ìš©í•œ ì¼ë³¸ì–´ ë¬¸ì¥ 3ê°œë§Œ ì•Œë ¤ì¤˜ (ë°œìŒ í¬í•¨)."
            };
            const input = document.getElementById('ai-input');
            input.value = prompts[type] || "";
            sendMessage();
        }

        function handleEnter(e) { if(e.key === 'Enter') sendMessage(); }

        function addMessage(role, text) {
            const div = document.createElement('div');
            const id = 'msg-' + Date.now();
            div.id = id;
            div.className = role === 'user' ? "flex items-start gap-2 justify-end" : "flex items-start gap-2";
            div.innerHTML = role === 'user' 
                ? `<div class="bg-violet-500 text-white p-3 rounded-lg shadow-sm max-w-[85%] text-left">${text}</div>`
                : `<div class="bg-violet-100 p-2 rounded-full flex-shrink-0"><i class="fa-solid fa-robot text-violet-600"></i></div><div class="bg-white p-3 rounded-lg shadow-sm border border-slate-100 max-w-[85%] text-slate-700 prose text-sm">${text}</div>`;
            const container = document.getElementById('chat-messages');
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
            return id;
        }

        async function sendMessage() {
            const key = getApiKey();
            if (!key) return;

            const input = document.getElementById('ai-input');
            const msg = input.value.trim();
            if (!msg) return;

            addMessage('user', msg);
            input.value = '';
            const loadId = addMessage('ai', '<i class="fa-solid fa-spinner fa-spin"></i> ìƒê° ì¤‘...');

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: msg }] }],
                        systemInstruction: { parts: [{ text: "ë‹¹ì‹ ì€ ì˜¤í‚¤ë‚˜ì™€ í—ˆë‹ˆë¬¸ ì—¬í–‰ ì»¨ì‹œì–´ì§€ì…ë‹ˆë‹¤. ì¹œì ˆí•˜ê³  ê°„ê²°í•˜ê²Œ(300ì ì´ë‚´) ë‹µë³€í•˜ì„¸ìš”." }] }
                    })
                });

                if (!response.ok) throw new Error(response.status === 400 || response.status === 403 ? 'KEY_ERROR' : 'NET_ERROR');
                
                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;
                
                const contentDiv = document.getElementById(loadId).querySelector('.bg-white');
                contentDiv.innerHTML = marked.parse(aiText);
            } catch (err) {
                const contentDiv = document.getElementById(loadId).querySelector('.bg-white');
                if (err.message === 'KEY_ERROR') {
                    contentDiv.innerHTML = 'âš ï¸ API í‚¤ê°€ ì˜ëª»ëœ ê²ƒ ê°™ìŠµë‹ˆë‹¤. <button onclick="resetApiKey()" class="underline text-red-500">ì—¬ê¸°</button>ë¥¼ ëˆŒëŸ¬ í‚¤ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                } else {
                    contentDiv.innerText = 'ì£„ì†¡í•©ë‹ˆë‹¤. ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                }
                console.error(err);
            }
        }

        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
