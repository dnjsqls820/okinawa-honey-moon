<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 ì˜¤í‚¤ë‚˜ì™€ í—ˆë‹ˆë¬¸ í”Œë˜ë„ˆ (Perfect)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #F0F9FF;
            color: #334155;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 300px;
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }

        .active-tab { background-color: #0EA5E9; color: white; border-color: #0EA5E9; }
        
        .timeline-line {
            position: absolute; left: 20px; top: 0; bottom: 0; width: 2px; background-color: #CBD5E1; z-index: 0;
        }

        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }

        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3498db;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col relative">

    <!-- Navbar -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center">
                    <i class="fa-solid fa-plane-departure text-sky-500 text-2xl mr-3"></i>
                    <h1 class="font-bold text-xl text-slate-800">Okinawa Honeymoon <span class="text-xs font-normal text-slate-500 block sm:inline">2025.12.02 - 12.09</span></h1>
                </div>
                <div class="text-sm font-medium text-sky-600">
                    <span id="current-weather-icon"></span> Day <span id="current-day-display">1</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 space-y-12 pb-24">

        <!-- Section 1: Overview -->
        <section id="overview" class="bg-white rounded-2xl shadow-sm p-6 border border-slate-100">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">ì—¬í–‰ ê°œìš”</h2>
                <p class="text-slate-600">ë¶€ì„¸ë‚˜(íœ´ì–‘) â†’ ë”ë¸”íŠ¸ë¦¬(ì‹œí‹°) â†’ ë¥˜íí˜¸í…”(ëŸ­ì…”ë¦¬)ë¡œ ì´ì–´ì§€ëŠ” ì™„ë²½í•œ ë™ì„ .</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="bg-slate-50 rounded-xl p-4">
                    <h3 class="text-center font-semibold text-slate-700 mb-4">ìˆ™ë°• ì¼ì • (7ë°•)</h3>
                    <div class="chart-container">
                        <canvas id="tripChart"></canvas>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-sky-50 p-4 rounded-xl text-center">
                        <i class="fa-solid fa-car text-sky-500 text-2xl mb-2"></i>
                        <h4 class="font-bold text-slate-700">ë Œí„°ì¹´ ì •ë³´</h4>
                        <p class="text-xs text-slate-500">ì¸ìˆ˜: 12/2 14:00</p>
                        <p class="text-xs text-slate-500">ë°˜ë‚©: 12/9 10:00</p>
                        <p class="text-xs text-indigo-500 font-bold mt-1 cursor-pointer" onclick="copyToClipboard('33 033 115*60')">ë°˜ë‚©ì¥ì†Œ ë§µì½”ë“œ ë³µì‚¬</p>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-xl text-center">
                        <i class="fa-solid fa-plane text-orange-400 text-2xl mb-2"></i>
                        <h4 class="font-bold text-slate-700">í•­ê³µ ì¼ì •</h4>
                        <p class="text-xs text-slate-500">ì¶œêµ­: 12/2 10:10</p>
                        <p class="text-xs text-slate-500">ê·€êµ­: 12/9 13:40</p>
                    </div>
                    <div class="bg-emerald-50 p-4 rounded-xl text-center col-span-2">
                        <i class="fa-solid fa-temperature-half text-emerald-500 text-2xl mb-2"></i>
                        <h4 class="font-bold text-slate-700">12ì›” ì²«ì£¼ ë‚ ì”¨ ì˜ˆë³´</h4>
                        <div class="flex justify-between items-center mt-2 px-2 text-sm text-slate-600">
                            <div class="flex flex-col items-center"><i class="fa-solid fa-cloud-sun"></i><span>í™”</span><span class="text-xs">25Â°</span></div>
                            <div class="flex flex-col items-center"><i class="fa-solid fa-cloud"></i><span>ìˆ˜</span><span class="text-xs">23Â°</span></div>
                            <div class="flex flex-col items-center"><i class="fa-solid fa-sun text-orange-400"></i><span>ëª©</span><span class="text-xs">24Â°</span></div>
                            <div class="flex flex-col items-center"><i class="fa-solid fa-cloud-rain text-blue-400"></i><span>ê¸ˆ</span><span class="text-xs">21Â°</span></div>
                            <div class="flex flex-col items-center"><i class="fa-solid fa-cloud-sun"></i><span>í† </span><span class="text-xs">22Â°</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Itinerary -->
        <section id="itinerary" class="bg-white rounded-2xl shadow-sm p-6 border border-slate-100">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">ì¼ë³„ ìƒì„¸ ì¼ì •</h2>
                <p class="text-slate-600">íƒ­ì„ í´ë¦­í•˜ë©´ ë‚ ì§œë³„ ë‚ ì”¨, ë™ì„ , ë§µì½”ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
            <div class="flex overflow-x-auto space-x-2 pb-4 scrollbar-hide mb-6" id="date-tabs"></div>
            <div id="day-content" class="min-h-[400px]"></div>
        </section>

        <!-- Section 3: Food -->
        <section id="food" class="bg-white rounded-2xl shadow-sm p-6 border border-slate-100">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">ë§›ì§‘ ëŒ€ì‹œë³´ë“œ</h2>
                <p class="text-slate-600">ì§ì ‘ ì°¾ì€ ë§›ì§‘(My Pick)ê³¼ í˜„ì§€ì¸ ì¶”ì²œ ë§›ì§‘ì„ ë‚˜ëˆ ì„œ ë³´ì„¸ìš”.</p>
            </div>
            <div class="flex space-x-4 mb-6 border-b border-slate-200 pb-2">
                <button onclick="switchFoodTab('mypick')" id="tab-mypick" class="text-sm font-bold pb-2 border-b-2 border-indigo-500 text-indigo-600 transition-colors">â¤ï¸ ë‚´ê°€ ì°¾ì€ ë§›ì§‘</button>
                <button onclick="switchFoodTab('local')" id="tab-local" class="text-sm font-medium pb-2 border-b-2 border-transparent text-slate-500 hover:text-slate-700 transition-colors">ğŸ‘ í˜„ì§€ì¸ ì¶”ì²œ (ë¡œì»¬)</button>
            </div>
            <div id="food-content-area"></div>
        </section>

        <!-- Section 4: Map Code Search (API Integrated) -->
        <section class="bg-slate-800 text-white rounded-2xl shadow-lg p-8 mb-8">
            <h2 class="text-xl font-bold mb-4"><i class="fa-solid fa-magnifying-glass mr-2"></i>ë§µì½”ë“œ ê²€ìƒ‰</h2>
            <div class="flex flex-col sm:flex-row gap-2">
                <input type="text" id="mapcode-search" placeholder="ì¥ì†Œëª… ì…ë ¥ (ì˜ˆ: ì´ì‹œêµ¬í›„, ë¶€ì„¸ë‚˜)" class="flex-grow p-3 rounded-lg text-slate-900 focus:outline-none focus:ring-2 focus:ring-sky-500" onkeypress="if(event.key === 'Enter') searchMapCodeAPI()">
                <button onclick="searchMapCodeAPI()" class="bg-sky-500 hover:bg-sky-600 text-white px-6 py-3 rounded-lg font-bold transition-colors whitespace-nowrap shadow-lg flex items-center justify-center min-w-[120px]">
                    <span id="search-btn-text">ì‹¤ì‹œê°„ ê²€ìƒ‰</span>
                    <div id="search-loader" class="loader ml-2 hidden"></div>
                </button>
            </div>
            
            <div id="local-results" class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm hidden"></div>
            <div id="api-results-area" class="mt-6 space-y-3"></div>
        </section>
        
        <!-- Settings Button -->
        <div class="text-center pb-8">
             <button onclick="resetApiKey()" class="text-xs text-slate-400 underline hover:text-slate-600">AI í‚¤ ì¬ì„¤ì •í•˜ê¸°</button>
        </div>

    </main>

    <!-- Floating AI Button -->
    <div class="fixed bottom-6 right-6 z-50">
        <button onclick="toggleAIChat()" class="bg-gradient-to-r from-violet-500 to-fuchsia-500 hover:from-violet-600 hover:to-fuchsia-600 text-white rounded-full p-4 shadow-xl transition-all transform hover:scale-105 flex items-center gap-2">
            <i class="fa-solid fa-wand-magic-sparkles text-xl"></i>
            <span class="font-bold hidden sm:inline">AI ì»¨ì‹œì–´ì§€</span>
        </button>
    </div>

    <!-- AI Chat Modal -->
    <div id="ai-chat-modal" class="hidden fixed bottom-24 right-6 w-80 sm:w-96 bg-white rounded-2xl shadow-2xl border border-slate-200 z-50 flex flex-col overflow-hidden h-[500px]">
        <div class="bg-gradient-to-r from-violet-500 to-fuchsia-500 p-4 text-white flex justify-between items-center">
            <div class="flex items-center gap-2"><i class="fa-solid fa-robot"></i><h3 class="font-bold">AI ì—¬í–‰ ì»¨ì‹œì–´ì§€</h3></div>
            <button onclick="toggleAIChat()" class="text-white hover:text-slate-200"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="chat-messages" class="flex-grow p-4 overflow-y-auto bg-slate-50 space-y-4 text-sm">
            <div class="flex items-start gap-2">
                <div class="bg-violet-100 p-2 rounded-full"><i class="fa-solid fa-robot text-violet-600"></i></div>
                <div class="bg-white p-3 rounded-lg shadow-sm border border-slate-100 max-w-[85%] text-slate-700">
                    ì•ˆë…•í•˜ì„¸ìš”! ëª¨ë“  ë§µì½”ë“œë¥¼ ìµœì‹ ìœ¼ë¡œ ê²€ì¦ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.<br>ì•ˆì‹¬í•˜ê³  ì—¬í–‰í•˜ì„¸ìš”!
                </div>
            </div>
        </div>
        <div class="p-3 bg-white border-t border-slate-100 flex gap-2">
            <input type="text" id="ai-input" placeholder="ë©”ì‹œì§€ ì…ë ¥..." class="flex-grow bg-slate-100 border-0 rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-violet-300 outline-none" onkeypress="handleEnter(event)">
            <button onclick="sendMessage()" class="bg-violet-500 text-white rounded-full w-10 h-10 flex items-center justify-center hover:bg-violet-600 transition-colors"><i class="fa-solid fa-paper-plane text-sm"></i></button>
        </div>
    </div>

    <script>
        // --- CONSTANTS ---
        const OKINAWA_BOUNDS = { south: 26.04, west: 127.60, north: 26.90, east: 128.35 };

        // --- ITINERARY DATA (Verified) ---
        const itinerary = [
            { date: "12/2 (í™”)", day: 1, title: "ì˜¤í‚¤ë‚˜ì™€ ë„ì°© & ë¶€ì„¸ë‚˜", stay: "ë” ë¶€ì„¸ë‚˜ í…Œë¼ìŠ¤", weather: { icon: "fa-cloud-sun", temp: "25Â°", desc: "êµ¬ë¦„ ë§ìŒ" }, schedule: [ { time: "10:10", activity: "ì¸ì²œ ì¶œë°œ", note: "ì„¤ë ˆëŠ” ì‹ í˜¼ì—¬í–‰ ì‹œì‘!" }, { time: "12:35", activity: "ë‚˜í•˜ ê³µí•­ ë„ì°©", note: "ì§ ì°¾ê¸° ë° ì…”í‹€ ì´ë™" }, { time: "14:00", activity: "ë Œí„°ì¹´ í”½ì—…", note: "ë§ˆë¦¬ì˜¤ ë Œí„°ì¹´ (ë‚˜í•˜ê³µí•­ì )", mapCode: "33 033 115*60" }, { time: "16:30", activity: "ë” ë¶€ì„¸ë‚˜ í…Œë¼ìŠ¤ ì²´í¬ì¸", note: "ì›°ì»´ ë“œë§í¬ & ì„ ì…‹ ì‚°ì±…", mapCode: "206 412 057*05" }, { time: "18:30", activity: "ì €ë…: ì¸„ë¼í•˜ë‚˜", note: "í˜¸í…” ê·¼ì²˜ ë¡œì»¬ ê°€ì •ì‹ (í‰ì  4.2+)", mapCode: "206 444 122*61" } ] },
            { date: "12/3 (ìˆ˜)", day: 2, title: "ë¶ë¶€ íë§ & í•´ì¤‘ ì „ë§ëŒ€", stay: "ë” ë¶€ì„¸ë‚˜ í…Œë¼ìŠ¤", weather: { icon: "fa-cloud", temp: "23Â°", desc: "íë¦¼" }, schedule: [ { time: "10:00", activity: "ë¶€ì„¸ë‚˜ í•´ì¤‘ ì „ë§ëŒ€", note: "í˜¸í…” ë‚´ ì‹œì„¤", mapCode: "206 442 075*11" }, { time: "12:30", activity: "ì ì‹¬: ìº¡í‹´ ìº¥ê±°ë£¨", note: "â˜…ì´ì „í•¨! ì¸ìƒ í–„ë²„ê±°", mapCode: "206 625 846*23" }, { time: "14:30", activity: "ë¹„ì„¸í›„ì¿ ê¸¸ & ì¸„ë¼ìš°ë¯¸", note: "ë¶ë¶€ í•„ìˆ˜ ì½”ìŠ¤", mapCode: "553 075 797*77" }, { time: "19:00", activity: "ì €ë…: ì½œë¡¬ë¹ˆ (ìŠ¤í…Œì´í¬)", note: "ë‚˜ê³  ì‹œë‚´ ë ˆíŠ¸ë¡œ ìŠ¤í…Œì´í¬", mapCode: "485 601 832*80" } ] },
            { date: "12/4 (ëª©)", day: 3, title: "ì¤‘ë¶€ ì´ë™ & ì•„ë©”ë¹Œ", stay: "ë”ë¸”íŠ¸ë¦¬ ì°¨íƒ„", weather: { icon: "fa-sun", temp: "24Â°", desc: "ë§‘ìŒ" }, schedule: [ { time: "11:00", activity: "ì²´í¬ì•„ì›ƒ & ë‚¨í•˜", note: "í•´ì•ˆë„ë¡œ ë“œë¼ì´ë¸Œ" }, { time: "12:30", activity: "ì ì‹¬: ë‚˜ì¹´ë¬´ë¼ ì†Œë°”", note: "ë§Œìëª¨ ê·¼ì²˜ ì•„ì‚¬ì†Œë°”", mapCode: "206 313 455*06" }, { time: "15:00", activity: "ë”ë¸”íŠ¸ë¦¬ ì°¨íƒ„ ì²´í¬ì¸", note: "â˜…í˜¸í…” ì£¼ì°¨ì¥ ì…êµ¬", mapCode: "33 525 590*15" }, { time: "17:30", activity: "ì•„ë©”ë¦¬ì¹¸ ë¹Œë¦¬ì§€ ì•¼ê²½", note: "í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë¶„ìœ„ê¸° ì¦ê¸°ê¸°", mapCode: "33 526 450*63" }, { time: "19:00", activity: "ì €ë…: ìŠ¤í…Œì´í¬ í•˜ìš°ìŠ¤ 88", note: "ì˜¤í‚¤ë‚˜ì™€ í´ë˜ì‹ ìŠ¤í…Œì´í¬", mapCode: "33 525 808*11" } ] },
            { date: "12/5 (ê¸ˆ)", day: 4, title: "í‘¸ë¥¸ë™êµ´ & ì¹´í˜ íˆ¬ì–´", stay: "ë”ë¸”íŠ¸ë¦¬ ì°¨íƒ„", weather: { icon: "fa-cloud-rain", temp: "21Â°", desc: "í•œë•Œ ë¹„" }, schedule: [ { time: "10:00", activity: "í‘¸ë¥¸ë™êµ´ ìŠ¤ë…¸í´ë§", note: "ë§ˆì—ë‹¤ ê³¶ (ë‚ ì”¨ í™•ì¸ í•„ìˆ˜)", mapCode: "206 062 685*85" }, { time: "13:00", activity: "ì ì‹¬: êµ¬ë¥´ë©” ìŠ¤ì‹œ", note: "ì•„ë©”ë¹Œ íšŒì „ì´ˆë°¥ ë§›ì§‘", mapCode: "33 526 489*36" }, { time: "15:00", activity: "ë°˜íƒ€ ì¹´í˜", note: "ë¹„ê°€ ì™€ë„ ì¢‹ì€ ì˜¤ì…˜ë·° (ì£¼ì°¨ì¥)", mapCode: "33 881 570*86" }, { time: "18:00", activity: "í˜¸í…” íœ´ì‹ & ìˆ˜ì˜ì¥", note: "ë”ë¸”íŠ¸ë¦¬ ë¶€ëŒ€ì‹œì„¤ ì¦ê¸°ê¸°" } ] },
            { date: "12/6 (í† )", day: 5, title: "ì´ì˜¨ëª° & ì‡¼í•‘ ë°ì´", stay: "ë”ë¸”íŠ¸ë¦¬ ì°¨íƒ„", weather: { icon: "fa-cloud-sun", temp: "22Â°", desc: "êµ¬ë¦„ ì¡°ê¸ˆ" }, schedule: [ { time: "11:00", activity: "ì´ì˜¨ëª° ë¼ì´ì¹´ë¬´", note: "ì´ˆëŒ€í˜• ì‡¼í•‘ëª°", mapCode: "33 530 406*45" }, { time: "14:00", activity: "ì ì‹¬: ì¿ ë¼ìŠ¤ì‹œ", note: "ì‡¼í•‘ëª° ë‚´ íšŒì „ì´ˆë°¥", mapCode: "33 530 268*06" }, { time: "16:30", activity: "ë¯¸ë‚˜í† ê°€ì™€ ì‚°ì±…", note: "ì™¸êµ­ì¸ ì£¼íƒê±°ë¦¬ (ì£¼ì°¨ì¥)", mapCode: "33 341 033*55" }, { time: "19:00", activity: "ì €ë…: ë¸”ë£¨ì‹¤ & íƒ€ì½”ë¼ì´ìŠ¤", note: "ì•„ë©”ë¹Œì—ì„œ ê°€ë³ê²Œ ì•¼ì‹" } ] },
            { date: "12/7 (ì¼)", day: 6, title: "ë‚¨ë¶€ ì´ë™ & ëŸ­ì…”ë¦¬ í˜¸ìº‰ìŠ¤", stay: "ë¥˜í í˜¸í…” ë‚˜ì‹œë¡œ", weather: { icon: "fa-sun", temp: "23Â°", desc: "ë§‘ìŒ" }, schedule: [ { time: "11:00", activity: "ì²´í¬ì•„ì›ƒ & ì´ë™", note: "ì´í† ë§Œ ë°©í–¥ (ë‚¨ë¶€)" }, { time: "12:30", activity: "ìš°ë¯¸ì¹´ì§€ í…Œë¼ìŠ¤", note: "ê³µí•­ ë·° ì¹´í˜", mapCode: "33 002 602*06" }, { time: "15:00", activity: "ë¥˜í í˜¸í…” ë‚˜ì‹œë¡œ ì²´í¬ì¸", note: "ì‹ ìƒ ëŸ­ì…”ë¦¬ ë¦¬ì¡°íŠ¸ ì¦ê¸°ê¸°", mapCode: "232 365 258*14" }, { time: "18:30", activity: "ì €ë…: ì´í† ë§Œ ì–´ë¯¼ ì‹ë‹¹", note: "â˜…ë²„í„° ìƒì„ êµ¬ì´ í•„ìˆ˜(ëŒ€ê¸° ìˆìŒ)", mapCode: "232 484 666*41" } ] },
            { date: "12/8 (ì›”)", day: 7, title: "ë‚¨ë¶€ íˆ¬ì–´ & ë§ˆì§€ë§‰ ë°¤", stay: "ë¥˜í í˜¸í…” ë‚˜ì‹œë¡œ", weather: { icon: "fa-cloud-sun", temp: "24Â°", desc: "ë§‘ìŒ" }, schedule: [ { time: "10:30", activity: "ì¹˜ë„¨ ë¯¸ì‚¬í‚¤ ê³µì›", note: "íƒ íŠ¸ì¸ íƒœí‰ì–‘ ë·°", mapCode: "232 594 503*33" }, { time: "12:00", activity: "ì ì‹¬: ì°»ì§‘ ë§ˆì¹´ë²  ì°¨ì´ë‚˜", note: "ê³ íƒì—ì„œ ë¨¹ëŠ” ì†Œë°”", mapCode: "232 396 033*22" }, { time: "15:00", activity: "í˜¸í…” ìˆ˜ì˜ì¥ & ë¹„ì¹˜", note: "ë§ˆì§€ë§‰ í˜¸ìº‰ìŠ¤ ëˆ„ë¦¬ê¸°" }, { time: "19:00", activity: "ì €ë…: ì•¼í‚¤ë‹ˆì¿  ì½©ê³ ", note: "ì´í† ë§Œ ì‹œë‚´ ì™€ê·œ ë§›ì§‘", mapCode: "232 485 186*55" } ] },
            { date: "12/9 (í™”)", day: 8, title: "ê·€êµ­", stay: "ì§‘ìœ¼ë¡œ", weather: { icon: "fa-plane", temp: "23Â°", desc: "ê·€êµ­" }, schedule: [ { time: "09:00", activity: "ì²´í¬ì•„ì›ƒ", note: "ì—¬ê¶Œ, ì§€ê°‘ í™•ì¸!" }, { time: "10:00", activity: "ë Œí„°ì¹´ ë°˜ë‚©", note: "ë§ˆë¦¬ì˜¤ ë Œí„°ì¹´ (ë‚˜í•˜ê³µí•­ì )", mapCode: "33 033 115*60" }, { time: "11:00", activity: "ë‚˜í•˜ ê³µí•­ ìˆ˜ì†", note: "ë©´ì„¸ì  (ë¡œì´ì¦ˆ, ë² ë‹ˆì´ëª¨)" }, { time: "13:40", activity: "ì¸ì²œí–‰ ì¶œë°œ", note: "í–‰ë³µí•œ ì‹ í˜¼ì—¬í–‰ ë§ˆë¬´ë¦¬ â¤ï¸" } ] }
        ];

        // --- FOOD DATA (Verified) ---
        const foodData = {
            mypick: [
                { region: "ë¶ë¶€", name: "ì‚¿ì§±ì†Œë°” (Satchan Soba)", desc: "ì¸„ë¼ìš°ë¯¸ ê°€ëŠ” ê¸¸ í˜„ì§€ ë§›ì§‘, ì„¸íŠ¸ 1000ì—”ëŒ€", map: "206 627 726*62" },
                { region: "ì¤‘ë¶€", name: "ë¯¸ë‚˜í† ê°€ì™€ ì˜¤í•˜ì½”ë¥´í…Œ", desc: "ê³¼ì¼ íƒ€ë¥´íŠ¸ ì „ë¬¸ì , ê°ì„± ì¸í…Œë¦¬ì–´", map: "33 341 002*28" },
                { region: "ì¤‘ë¶€", name: "ì„¸ë¼ë„ ì»¤í”¼", desc: "ì§ì ‘ ë¡œìŠ¤íŒ…í•œ ì›ë‘, ë¯¸ë‚˜í† ê°€ì™€", map: "33 341 062*77" },
                { region: "ì¤‘ë¶€", name: "í† ë¦¬ì†Œë°”ì•¼ ì´ì‹œêµ¬í›„", desc: "ì˜¤í‚¤ë‚˜ì™€ ì´ˆëŒ€ ì†Œë°” ì™•ì¢Œ, ë‹­ìœ¡ìˆ˜", map: "33 341 094*14" },
                { region: "ì¤‘ë¶€", name: "í”Œë¼ìš°ë§ŒìŠ¤ ëŸ°ì¹˜ ë² ì´ì»¤ë¦¬", desc: "ì–¸ë• ìœ„ ë¹µê³¼ ë¸ŒëŸ°ì¹˜ (ì…êµ¬ ì£¼ì˜)", map: "33 440 816*85" },
                { region: "ì¤‘ë¶€", name: "ì‚°ìŠ¤ì‹œ (SANS SOUCI)", desc: "í‚¤íƒ€ë‚˜ì¹´êµ¬ìŠ¤ì¿  êµí† ì‹ ìš°ë™/ë®ë°¥", map: "33 440 524*03" },
                { region: "ì¤‘ë¶€", name: "ë°˜íƒ€ ì¹´í˜", desc: "í˜¸ì‹œë…¸ ë¦¬ì¡°íŠ¸ ìš´ì˜, ì••ë„ì  ì˜¤ì…˜ë·°(ì£¼ì°¨ì¥)", map: "33 881 570*86" },
                { region: "ë‚¨ë¶€", name: "ì•¼ë¼ë‹ˆê¾¸ í‘¸ë£¨ì‹  (ì¿ ëª¨ì§€)", desc: "ë§ˆëŠ˜ ì•¼í‚¤ë‹ˆì¿  & ìˆ  ë¬´ì œí•œ", map: "33 157 248*25" },
                { region: "ë‚¨ë¶€", name: "ë§ˆì œë©˜ ë§ˆí˜¸ë¡œë°”", desc: "ì¤‘ë…ì„± ìˆëŠ” ë¹„ë¹”ë¼ë©˜", map: "33 157 266*82" }
            ],
            local: [
                { region: "ë¶ë¶€", name: "ì¸„ë¼í•˜ë‚˜ (Chura-Hana)", desc: "ë¶€ì„¸ë‚˜ ê·¼ì²˜ 1ë“± ê°€ì •ì‹, í‘ë¼ì§€ ëˆê¹ŒìŠ¤", map: "206 444 122*61" },
                { region: "ë¶ë¶€", name: "ì½œë¡¬ë¹ˆ (Colombin)", desc: "í˜„ì§€ì¸ì´ ì‚¬ë‘í•˜ëŠ” ë ˆíŠ¸ë¡œ ìŠ¤í…Œì´í¬", map: "485 601 832*80" },
                { region: "ë¶ë¶€", name: "ìº¡í‹´ ìº¥ê±°ë£¨ (ì´ì „í•¨!)", desc: "ì¸ìƒ í–„ë²„ê±° ë§›ì§‘ (ìƒˆì£¼ì†Œ)", map: "206 625 846*23" },
                { region: "ì¤‘ë¶€", name: "êµ¬ë¥´ë©” ìŠ¤ì‹œ (ì•„ë©”ë¹Œ)", desc: "ê°€ì„±ë¹„ íšŒì „ì´ˆë°¥", map: "33 526 489*36" },
                { region: "ì¤‘ë¶€", name: "ìŠ¤í…Œì´í¬ í•˜ìš°ìŠ¤ 88", desc: "ë¯¸êµ° ê¸°ì§€ ê·¼ì²˜ ì •í†µ ìŠ¤í…Œì´í¬", map: "33 525 808*11" },
                { region: "ë‚¨ë¶€", name: "ì´í† ë§Œ ì–´ë¯¼ ì‹ë‹¹", desc: "ë¥˜í í˜¸í…” ê·¼ì²˜ ì›íƒ‘, ë²„í„°ì•¼í‚¤ í•„ìˆ˜", map: "232 484 666*41" },
                { region: "ë‚¨ë¶€", name: "ì°»ì§‘ ë§ˆì¹´ë²  ì°¨ì´ë‚˜", desc: "ë¬¸í™”ì¬ ê³ íƒì—ì„œ ë¨¹ëŠ” ì†Œë°”", map: "232 396 033*22" }
            ]
        };

        const searchCodes = [
            {name:"ë” ë¶€ì„¸ë‚˜ í…Œë¼ìŠ¤",code:"206 412 057*05"}, {name:"ë”ë¸”íŠ¸ë¦¬ ì°¨íƒ„",code:"33 525 590*15"}, {name:"ë¥˜í í˜¸í…” ë‚˜ì‹œë¡œ",code:"232 365 258*14"},
            {name:"ì¸„ë¼ìš°ë¯¸ ìˆ˜ì¡±ê´€",code:"553 075 797*77"}, {name:"ì½”ìš°ë¦¬ ëŒ€êµ",code:"485 662 041*33"}, {name:"ë§Œìëª¨",code:"206 312 039*17"},
            {name:"ì•„ë©”ë¦¬ì¹¸ ë¹Œë¦¬ì§€",code:"33 526 450*63"}, {name:"í‘¸ë¥¸ë™êµ´",code:"206 062 685*85"}, {name:"ì´í† ë§Œ ì–´ë¯¼ì‹ë‹¹",code:"232 484 666*41"},
            {name:"ë‚˜í•˜ ê³µí•­",code:"33 123 279*00"}, {name:"ë§ˆë¦¬ì˜¤ ë Œí„°ì¹´",code:"33 033 115*60"}
        ];

        // --- FUNCTIONS ---
        function copyToClipboard(text) {
            const cleanText = text.split('(')[0].trim();
            const textArea = document.createElement("textarea");
            textArea.value = cleanText;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                const toast = document.createElement('div');
                toast.className = "fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-4 py-2 rounded-full text-sm z-50 animate-slide-up shadow-lg flex items-center gap-2";
                toast.innerHTML = `<i class="fa-solid fa-check text-green-400"></i><span>ë§µì½”ë“œ ë³µì‚¬ì™„ë£Œ: </span><span class="font-mono font-bold text-yellow-300">${cleanText}</span>`;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 2500);
            } catch (err) {
                prompt("ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”:", cleanText);
            }
            document.body.removeChild(textArea);
        }

        function openExternalSearch() {
            window.open('https://japanmapcode.com/ko', '_blank');
        }

        // --- NEW: JAPAN MAP CODE API INTEGRATION ---
        async function searchMapCodeAPI() {
            const query = document.getElementById('mapcode-search').value.trim();
            if (!query) return alert('ì¥ì†Œëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

            const resultArea = document.getElementById('api-results-area');
            const localResults = document.getElementById('local-results');
            const loader = document.getElementById('search-loader');
            const btnText = document.getElementById('search-btn-text');

            // 1. Show Local Matches first
            const hits = searchCodes.filter(i => i.name.toLowerCase().includes(query.toLowerCase()));
            if (hits.length > 0) {
                localResults.classList.remove('hidden');
                localResults.innerHTML = hits.map(i => `<div class="bg-slate-700 p-3 rounded flex justify-between items-center hover:bg-slate-600 transition cursor-pointer" onclick="copyToClipboard('${i.code}')"><span><i class="fa-solid fa-star text-yellow-400 mr-2"></i>${i.name} (ì €ì¥ë¨)</span><span class="font-mono text-sky-300 text-xs">${i.code} <i class="fa-solid fa-copy ml-1"></i></span></div>`).join('');
            } else {
                localResults.innerHTML = '';
                localResults.classList.add('hidden');
            }

            // 2. Start API Search
            resultArea.innerHTML = ''; 
            btnText.innerText = 'ê²€ìƒ‰ì¤‘...';
            loader.classList.remove('hidden');

            try {
                // Step 1: Search Places
                const searchResponse = await fetch('https://japanmapcode.com/places', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: query,
                        bounds: OKINAWA_BOUNDS,
                        lang: "ko"
                    })
                });

                if (!searchResponse.ok) throw new Error('Network error');
                const searchData = await searchResponse.json();

                if (!searchData.places || searchData.places.length === 0) {
                    resultArea.innerHTML = `<div class="bg-slate-700 p-4 rounded text-center text-slate-300">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                } else {
                    resultArea.innerHTML = searchData.places.map(place => `
                        <div class="bg-slate-600 p-4 rounded-lg hover:bg-slate-500 transition cursor-pointer group" onclick="fetchAndCopyMapCode('${place.place_id}', '${place.name}')">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-bold text-white group-hover:text-sky-300">${place.name}</h4>
                                    <p class="text-xs text-slate-300 mt-1">${place.formatted_address}</p>
                                </div>
                                <i class="fa-solid fa-chevron-right text-slate-400 group-hover:text-white mt-2"></i>
                            </div>
                        </div>
                    `).join('');
                }

            } catch (error) {
                console.error(error);
                resultArea.innerHTML = `<div class="text-red-400 text-sm text-center">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>`;
            } finally {
                btnText.innerText = 'ì‹¤ì‹œê°„ ê²€ìƒ‰';
                loader.classList.add('hidden');
            }
        }

        async function fetchAndCopyMapCode(placeId, placeName) {
            const toast = document.createElement('div');
            toast.id = 'loading-toast';
            toast.className = "fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full text-sm z-50 shadow-lg flex items-center";
            toast.innerHTML = `<div class="loader mr-3" style="width:15px; height:15px; border-width:2px;"></div> ${placeName} ë§µì½”ë“œ ê°€ì ¸ì˜¤ëŠ” ì¤‘...`;
            document.body.appendChild(toast);

            try {
                const response = await fetch('https://japanmapcode.com/place-details', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        placeId: placeId,
                        lang: "ko"
                    })
                });

                if (!response.ok) throw new Error('Detail fetch error');
                const data = await response.json();

                if (data.mapcode) {
                    document.getElementById('loading-toast').remove();
                    copyToClipboard(data.mapcode); 
                } else {
                    throw new Error('No mapcode found');
                }

            } catch (error) {
                document.getElementById('loading-toast').remove();
                alert('ë§µì½”ë“œë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // --- RENDER LOGIC ---
        function initApp() {
            renderChart();
            renderTabs();
            switchFoodTab('mypick');
        }

        function renderChart() {
            const ctx = document.getElementById('tripChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ë¶€ì„¸ë‚˜ (ë¶ë¶€)', 'ë”ë¸”íŠ¸ë¦¬ (ì¤‘ë¶€)', 'ë¥˜íí˜¸í…” (ë‚¨ë¶€)'],
                    datasets: [{ data: [2, 3, 2], backgroundColor: ['#10B981', '#0EA5E9', '#6366F1'], borderWidth: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: {position: 'bottom'} } }
            });
        }

        function renderTabs() {
            const container = document.getElementById('date-tabs');
            itinerary.forEach((day, idx) => {
                const btn = document.createElement('button');
                btn.className = `flex-shrink-0 px-4 py-2 rounded-full border text-sm font-medium transition-colors flex items-center gap-2 ${idx === 0 ? 'active-tab' : 'bg-white text-slate-500 border-slate-200 hover:bg-slate-50'}`;
                btn.innerHTML = `<span>${day.date}</span> <i class="fa-solid ${day.weather.icon} text-xs"></i>`;
                btn.onclick = () => switchTab(idx);
                container.appendChild(btn);
            });
            switchTab(0);
        }

        function switchTab(idx) {
            const tabs = document.getElementById('date-tabs').children;
            for(let i=0; i<tabs.length; i++) tabs[i].className = i===idx ? 'flex-shrink-0 px-4 py-2 rounded-full border text-sm font-medium transition-colors active-tab flex items-center gap-2' : 'flex-shrink-0 px-4 py-2 rounded-full border text-sm font-medium transition-colors bg-white text-slate-500 border-slate-200 hover:bg-slate-50 flex items-center gap-2';
            
            const data = itinerary[idx];
            document.getElementById('current-day-display').innerText = data.day;
            document.getElementById('current-weather-icon').innerHTML = `<i class="fa-solid ${data.weather.icon}"></i> ${data.weather.desc}`;
            
            let html = `<div class="bg-white rounded-xl p-4 mb-4 border-l-4 ${idx < 2 ? 'border-emerald-500' : (idx < 5 ? 'border-sky-500' : 'border-indigo-500')} shadow-sm">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-xl font-bold text-slate-800">${data.title}</h3>
                                <p class="text-sm text-slate-500 mt-1"><i class="fa-solid fa-bed mr-2"></i>${data.stay}</p>
                            </div>
                            <div class="text-right bg-slate-100 p-2 rounded-lg">
                                <div class="text-2xl font-bold text-slate-700">${data.weather.temp}</div>
                                <div class="text-xs text-slate-500"><i class="fa-solid ${data.weather.icon}"></i> ${data.weather.desc}</div>
                            </div>
                        </div>
                        </div><div class="relative mt-6"><div class="timeline-line"></div>`;
            
            data.schedule.forEach(item => {
                html += `<div class="relative pl-8 pb-8 group">
                        <div class="absolute left-0 top-1 w-4 h-4 rounded-full border-2 border-white shadow-sm z-10 ${idx < 2 ? 'bg-emerald-500' : (idx < 5 ? 'bg-sky-500' : 'bg-indigo-500')}"></div>
                        <div class="bg-slate-50 rounded-xl p-4 card-hover border border-slate-100">
                            <div class="flex justify-between items-start mb-1">
                                <span class="font-bold text-slate-800 text-lg">${item.time}</span>
                                ${item.mapCode ? `<span class="text-xs bg-slate-200 text-slate-600 px-2 py-1 rounded cursor-pointer hover:bg-slate-300" onclick="copyToClipboard('${item.mapCode}')"><i class="fa-solid fa-copy mr-1"></i>${item.mapCode}</span>` : ''}
                            </div>
                            <h4 class="font-bold text-base text-slate-700 mb-1">${item.activity}</h4>
                            <p class="text-sm text-slate-500">${item.note}</p>
                        </div></div>`;
            });
            document.getElementById('day-content').innerHTML = html + '</div>';
        }

        function switchFoodTab(tabType) {
            const btnMy = document.getElementById('tab-mypick');
            const btnLocal = document.getElementById('tab-local');
            
            if (tabType === 'mypick') {
                btnMy.className = "text-sm font-bold pb-2 border-b-2 border-indigo-500 text-indigo-600 transition-colors";
                btnLocal.className = "text-sm font-medium pb-2 border-b-2 border-transparent text-slate-500 hover:text-slate-700 transition-colors";
                renderFoodGrid(foodData.mypick);
            } else {
                btnMy.className = "text-sm font-medium pb-2 border-b-2 border-transparent text-slate-500 hover:text-slate-700 transition-colors";
                btnLocal.className = "text-sm font-bold pb-2 border-b-2 border-indigo-500 text-indigo-600 transition-colors";
                renderFoodGrid(foodData.local);
            }
        }

        function renderFoodGrid(items) {
            const container = document.getElementById('food-content-area');
            let html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
            
            items.forEach(item => {
                let badgeColor = item.region === 'ë¶ë¶€' ? 'bg-emerald-100 text-emerald-800' : (item.region === 'ì¤‘ë¶€' ? 'bg-sky-100 text-sky-800' : 'bg-indigo-100 text-indigo-800');
                
                html += `<div class="bg-slate-50 p-4 rounded-xl border border-slate-100 card-hover cursor-pointer relative" onclick="copyToClipboard('${item.map}')">
                    <span class="absolute top-3 right-3 text-xs font-bold px-2 py-1 rounded-full ${badgeColor}">${item.region}</span>
                    <h4 class="font-bold text-slate-700 pr-12">${item.name}</h4>
                    <p class="text-xs text-slate-500 mt-2 min-h-[40px]">${item.desc}</p>
                    <div class="mt-3 text-xs font-mono text-slate-400 bg-white p-2 rounded border border-slate-200 flex justify-between items-center">
                        <span>Map: ${item.map}</span>
                        <i class="fa-solid fa-copy"></i>
                    </div>
                </div>`;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function initSearch() {
            document.getElementById('mapcode-search').addEventListener('input', (e) => {
                const val = e.target.value.toLowerCase();
                const res = document.getElementById('search-results');
                if(!val) { res.innerHTML = ''; return; }
                const hits = searchCodes.filter(i => i.name.toLowerCase().includes(val));
                res.innerHTML = hits.length ? hits.map(i => `<div class="bg-slate-700 p-3 rounded flex justify-between items-center hover:bg-slate-600 transition cursor-pointer" onclick="copyToClipboard('${i.code}')"><span>${i.name}</span><span class="font-mono text-sky-300 text-xs">${i.code} <i class="fa-solid fa-copy ml-1"></i></span></div>`).join('') : '<p class="text-slate-400 col-span-2 text-center">ê²°ê³¼ ì—†ìŒ</p>';
            });
        }

        // --- SECURE AI LOGIC ---
        let isChatOpen = false;

        function getApiKey() {
            let key = localStorage.getItem('gemini_api_key');
            if (!key) {
                key = prompt("ğŸ”’ Gemini API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.\n(í‚¤ëŠ” ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤)");
                if (key) {
                    localStorage.setItem('gemini_api_key', key);
                    alert("âœ… API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
                }
            }
            return key;
        }

        function resetApiKey() {
            if(confirm("ì €ì¥ëœ API í‚¤ë¥¼ ì‚­ì œí•˜ê³  ë‹¤ì‹œ ì…ë ¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                localStorage.removeItem('gemini_api_key');
                alert("í‚¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. AI ê¸°ëŠ¥ì„ ë‹¤ì‹œ ì‚¬ìš©í•  ë•Œ ìƒˆ í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                location.reload();
            }
        }

        function toggleAIChat() {
            const modal = document.getElementById('ai-chat-modal');
            isChatOpen = !isChatOpen;
            if (isChatOpen) {
                if(!localStorage.getItem('gemini_api_key')) getApiKey();
                modal.classList.remove('hidden');
                modal.classList.add('animate-slide-up');
                setTimeout(() => document.getElementById('ai-input').focus(), 300);
            } else {
                modal.classList.add('hidden');
            }
        }

        function sendQuickPrompt(type) {
            const prompts = {
                pronounce: "ë°©ê¸ˆ ë³¸ ì¼ë³¸ì–´ ë¬¸ì¥ ì¤‘ì—ì„œ 'ì´ê±° ì£¼ì„¸ìš”'ë‘ 'ê³„ì‚°í•´ì£¼ì„¸ìš”' ì¼ë³¸ì–´ë¡œ ì–´ë–»ê²Œ ë§í•˜ëŠ”ì§€ í•œê¸€ ë°œìŒì´ë‘ ëœ» ì •í™•íˆ ì•Œë ¤ì¤˜.",
                recommend: "ì§€ê¸ˆ ë‚´ ì¼ì •(ë¶€ì„¸ë‚˜-ë”ë¸”íŠ¸ë¦¬-ë¥˜íí˜¸í…”) ê·¼ì²˜ì—ì„œ ê°€ë³ê²Œ ê°ˆë§Œí•œ ì¹´í˜ë‚˜ í¸ì˜ì  ê¿€ì¡°í•© ê°„ì‹ ì¶”ì²œí•´ì¤˜."
            };
            const input = document.getElementById('ai-input');
            input.value = prompts[type] || "";
            sendMessage();
        }

        function handleEnter(e) { if(e.key === 'Enter') sendMessage(); }

        function addMessage(role, text) {
            const div = document.createElement('div');
            const id = 'msg-' + Date.now();
            div.id = id;
            div.className = role === 'user' ? "flex items-start gap-2 justify-end" : "flex items-start gap-2";
            div.innerHTML = role === 'user' 
                ? `<div class="bg-violet-500 text-white p-3 rounded-lg shadow-sm max-w-[85%] text-left">${text}</div>`
                : `<div class="bg-violet-100 p-2 rounded-full flex-shrink-0"><i class="fa-solid fa-robot text-violet-600"></i></div><div class="bg-white p-3 rounded-lg shadow-sm border border-slate-100 max-w-[85%] text-slate-700 prose text-sm">${text}</div>`;
            const container = document.getElementById('chat-messages');
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
            return id;
        }

        async function sendMessage() {
            const key = getApiKey();
            if (!key) return;

            const input = document.getElementById('ai-input');
            const msg = input.value.trim();
            if (!msg) return;

            addMessage('user', msg);
            input.value = '';
            const loadId = addMessage('ai', '<i class="fa-solid fa-spinner fa-spin"></i> ìƒê° ì¤‘...');

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: msg }] }],
                        systemInstruction: { parts: [{ text: "ë‹¹ì‹ ì€ ì˜¤í‚¤ë‚˜ì™€ í—ˆë‹ˆë¬¸ ì—¬í–‰ ì»¨ì‹œì–´ì§€ì…ë‹ˆë‹¤. ì¹œì ˆí•˜ê³  ê°„ê²°í•˜ê²Œ(300ì ì´ë‚´) ë‹µë³€í•˜ì„¸ìš”." }] }
                    })
                });

                if (!response.ok) throw new Error(response.status === 400 || response.status === 403 ? 'KEY_ERROR' : 'NET_ERROR');
                
                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;
                
                const contentDiv = document.getElementById(loadId).querySelector('.bg-white');
                contentDiv.innerHTML = marked.parse(aiText);
            } catch (err) {
                const contentDiv = document.getElementById(loadId).querySelector('.bg-white');
                if (err.message === 'KEY_ERROR') {
                    contentDiv.innerHTML = 'âš ï¸ API í‚¤ê°€ ì˜ëª»ëœ ê²ƒ ê°™ìŠµë‹ˆë‹¤. <button onclick="resetApiKey()" class="underline text-red-500">ì—¬ê¸°</button>ë¥¼ ëˆŒëŸ¬ í‚¤ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                } else {
                    contentDiv.innerText = 'ì£„ì†¡í•©ë‹ˆë‹¤. ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                }
                console.error(err);
            }
        }

        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
